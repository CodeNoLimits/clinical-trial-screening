# 📘 מדריך מלא: Google AI Studio
## מערכת סינון מטופלים לניסויים קליניים - סוכרת סוג 2

---

## 🎯 מטרת השלב

יצירת פרוטוטייפ עובד של מערכת ההחלטה באמצעות Gemini, בדיקת הפרומפטים, ואיטרציה עד לקבלת תוצאות מדויקות.

**זמן משוער**: 2-3 שעות  
**דרישות**: חשבון Google בלבד  
**תוצר**: פרומפט עובד שניתן להעביר לשלב הבא

---

## 📋 שלב 1: כניסה והגדרה ראשונית

### 1.1 כניסה למערכת
1. פתח את הדפדפן ועבור ל: **https://aistudio.google.com**
2. לחץ על **"Sign in with Google"**
3. בחר את חשבון Google שלך
4. אשר את התנאים אם מתבקש

### 1.2 יצירת פרויקט חדש
1. בצד שמאל, וודא ש-**"Chat"** מסומן
2. לחץ על **"Create new prompt"** או התחל לכתוב ישירות
3. בחר מודל: **Gemini 2.0 Flash** (מהיר ומדויק) או **Gemini 1.5 Pro** (מתקדם יותר)

### 1.3 הגדרת Run Settings
בצד ימין, הגדר:
- **Temperature**: 0.3 (נמוך = תשובות עקביות יותר)
- **Top P**: 0.95
- **Top K**: 40
- **Max output tokens**: 2048

---

## 📋 שלב 2: הגדרת System Instructions

### 2.1 פתיחת הגדרות המערכת
1. לחץ על האייקון 📋 (assignment) בראש חלון הצ'אט
2. יופיע שדה **"System Instructions"**
3. העתק והדבק את הטקסט המלא הבא:

### 2.2 System Instructions להעתקה (עברית):

```
# מערכת סינון מטופלים לניסויים קליניים - סוכרת סוג 2

## זהות המערכת
אתה מערכת תומכת החלטה קלינית (Clinical Decision Support System) לסינון מטופלים לניסויים קליניים בתחום הסוכרת סוג 2. תפקידך לנתח נתוני מטופלים מול קריטריוני ניסוי ולספק המלצה מבוססת עובדות עם הסבר מלא.

## עקרונות פעולה
1. **דיוק מעל הכל** - בדוק כל קריטריון בנפרד, אל תדלג
2. **שקיפות** - הסבר את הנימוק לכל החלטה
3. **זהירות** - אם חסר מידע, ציין "לא ברור" ולא "כשיר"
4. **עקביות** - השתמש תמיד באותו פורמט פלט

## מבנה הקלט שתקבל

### קריטריוני הניסוי:
- **קריטריוני הכללה (Inclusion)**: תנאים שהמטופל חייב לעמוד בהם
- **קריטריוני הדרה (Exclusion)**: תנאים שפוסלים את המטופל

### נתוני מטופל:
נתונים בפורמט JSON הכוללים: גיל, מין, אבחנות, תרופות, בדיקות מעבדה, ועוד.

## תהליך הבדיקה (בצע בסדר הזה!)

### שלב א: בדיקת קריטריוני הכללה
לכל קריטריון הכללה:
1. זהה את הפרמטר הנדרש (למשל: גיל 18-75)
2. מצא את הערך המתאים בנתוני המטופל
3. השווה וקבע: מתקיים ✅ / לא מתקיים ❌ / לא ידוע ⚠️

### שלב ב: בדיקת קריטריוני הדרה
לכל קריטריון הדרה:
1. זהה את המצב הפוסל (למשל: הריון)
2. בדוק אם המצב קיים אצל המטופל
3. קבע: תקין ✅ (לא קיים) / פוסל ❌ (קיים) / לא ידוע ⚠️

### שלב ג: החלטה סופית
- **כשיר ✅**: כל קריטריוני ההכללה מתקיימים וכל קריטריוני ההדרה תקינים
- **לא כשיר ❌**: לפחות קריטריון הכללה אחד לא מתקיים או קריטריון הדרה אחד פוסל
- **לא ברור ⚠️**: חסר מידע קריטי שמונע החלטה

## פורמט הפלט (חובה!)

השתמש תמיד בפורמט הבא:

---

## 🏥 דוח כשירות לניסוי קליני

### מזהה מטופל: [ID]
### מזהה ניסוי: [Trial ID]

---

### 📊 החלטה סופית: [כשיר ✅ / לא כשיר ❌ / לא ברור ⚠️]

---

### ✅ בדיקת קריטריוני הכללה:

| # | קריטריון | ערך נדרש | ערך המטופל | סטטוס |
|---|----------|----------|------------|-------|
| 1 | [שם] | [טווח/ערך] | [מה שנמצא] | [✅/❌/⚠️] |
| 2 | ... | ... | ... | ... |

**סיכום הכללה**: [X מתוך Y קריטריונים מתקיימים]

---

### 🚫 בדיקת קריטריוני הדרה:

| # | קריטריון | מה פוסל | ממצא במטופל | סטטוס |
|---|----------|---------|-------------|-------|
| 1 | [שם] | [תיאור] | [מה נמצא] | [✅ תקין/❌ פוסל] |
| 2 | ... | ... | ... | ... |

**סיכום הדרה**: [X מתוך Y קריטריונים תקינים]

---

### 📝 נימוק מפורט:
[הסבר של 2-4 משפטים המפרט את הסיבות העיקריות להחלטה]

---

### ⚠️ נתונים חסרים (אם יש):
- [רשימת פרמטרים שלא נמצאו או לא ברורים]

---

### 💡 המלצה לצוות הקליני:
[המלצה מעשית - מה צריך לעשות עכשיו?]

---

## כללים חשובים

### לגבי ערכים חסרים:
- אם ערך קריטי חסר (כמו HbA1c) → "לא ברור"
- אם ערך משני חסר → ציין אך המשך בהערכה

### לגבי ערכי גבול:
- ערך בדיוק על הגבול (למשל גיל 75 כשהטווח 18-75) → **כשיר**
- ערך מעט מחוץ לגבול → **לא כשיר** עם ציון המרחק

### לגבי תרופות:
- חפש מילות מפתח כמו "אינסולין", "insulin" בכל הווריאציות
- שים לב לתאריכים - "ב-3 החודשים האחרונים" דורש חישוב

### לגבי מחלות נלוות:
- חפש מילות מפתח בתוך רשימת comorbidities
- "אי ספיקת לב NYHA II" ≠ "אי ספיקת לב NYHA III"

## שפה
ענה תמיד בעברית, גם אם הקלט באנגלית.
```

---

## 📋 שלב 3: בדיקה עם מטופלים לדוגמה

### 3.1 קריטריוני הניסוי (העתק לצ'אט):

```
## קריטריוני ניסוי DM2-2024-001: טיפול חדשני בסוכרת סוג 2

### קריטריוני הכללה:
1. גיל 18-75 שנים
2. אבחנת סוכרת סוג 2 מאושרת
3. HbA1c בין 7.0% ל-10.0%
4. eGFR > 45 mL/min/1.73m²

### קריטריוני הדרה:
1. הריון או הנקה
2. טיפול באינסולין ב-3 החודשים האחרונים
3. אי ספיקת לב NYHA Class III או IV
4. מחלת כבד פעילה (כולל שחמת)
```

### 3.2 מטופל לבדיקה #1 - צפי: כשיר ✅

```
נתוני מטופל P001:
{
  "patient_id": "P001",
  "age": 52,
  "gender": "זכר",
  "diagnosis": "סוכרת סוג 2",
  "diagnosis_date": "2020-03-15",
  "HbA1c": 8.2,
  "eGFR": 78,
  "creatinine": 1.0,
  "current_medications": ["מטפורמין 1000mg פעמיים ביום", "גליקלזיד 60mg"],
  "comorbidities": ["יתר לחץ דם"],
  "pregnancy_status": null,
  "clinical_notes": "מטופל יציב במעקב רגיל. ללא שינויים משמעותיים בטיפול. אינו משתמש באינסולין."
}

האם המטופל כשיר לניסוי?
```

### 3.3 מטופל לבדיקה #2 - צפי: לא כשיר ❌ (HbA1c גבוה)

```
נתוני מטופל P002:
{
  "patient_id": "P002",
  "age": 45,
  "gender": "נקבה",
  "diagnosis": "סוכרת סוג 2",
  "diagnosis_date": "2019-08-20",
  "HbA1c": 11.5,
  "eGFR": 82,
  "creatinine": 0.8,
  "current_medications": ["מטפורמין 850mg פעמיים ביום"],
  "comorbidities": [],
  "pregnancy_status": "לא בהריון",
  "clinical_notes": "סוכרת לא מאוזנת. שוקלים הוספת טיפול נוסף."
}

האם המטופל כשיר לניסוי?
```

### 3.4 מטופל לבדיקה #3 - צפי: לא כשיר ❌ (אינסולין + eGFR נמוך)

```
נתוני מטופל P003:
{
  "patient_id": "P003",
  "age": 68,
  "gender": "זכר",
  "diagnosis": "סוכרת סוג 2",
  "diagnosis_date": "2015-01-10",
  "HbA1c": 7.8,
  "eGFR": 38,
  "creatinine": 1.8,
  "current_medications": ["אינסולין גלרגין 20 יחידות בערב", "מטפורמין 500mg"],
  "comorbidities": ["אי ספיקת כליות כרונית שלב 3b", "אי ספיקת לב NYHA II"],
  "pregnancy_status": null,
  "clinical_notes": "מטופל עם תחלואה נלווית משמעותית. תפקוד כלייתי ירוד."
}

האם המטופל כשיר לניסוי?
```

### 3.5 מטופל לבדיקה #4 - צפי: לא כשיר ❌ (הריון)

```
נתוני מטופל P004:
{
  "patient_id": "P004",
  "age": 34,
  "gender": "נקבה",
  "diagnosis": "סוכרת סוג 2",
  "diagnosis_date": "2023-06-01",
  "HbA1c": 7.5,
  "eGFR": 95,
  "creatinine": 0.7,
  "current_medications": ["מטפורמין 1000mg פעמיים ביום"],
  "comorbidities": [],
  "pregnancy_status": "בהריון שבוע 12",
  "clinical_notes": "סוכרת הריונית שהתגלתה כסוג 2. במעקב הריון בסיכון."
}

האם המטופל כשיר לניסוי?
```

### 3.6 מטופל לבדיקה #5 - צפי: כשיר ✅ (מועמד אידיאלי)

```
נתוני מטופל P005:
{
  "patient_id": "P005",
  "age": 58,
  "gender": "זכר",
  "diagnosis": "סוכרת סוג 2",
  "diagnosis_date": "2018-11-30",
  "HbA1c": 8.8,
  "eGFR": 65,
  "creatinine": 1.2,
  "current_medications": ["מטפורמין 1000mg פעמיים ביום", "אמפגליפלוזין 10mg"],
  "comorbidities": ["יתר לחץ דם מאוזן", "דיסליפידמיה"],
  "pregnancy_status": null,
  "clinical_notes": "מטופל עם תחלואה נלווית מבוקרת. מועמד מצוין לניסוי."
}

האם המטופל כשיר לניסוי?
```

### 3.7 מטופל לבדיקה #6 - צפי: לא כשיר ❌ (גיל)

```
נתוני מטופל P006:
{
  "patient_id": "P006",
  "age": 77,
  "gender": "זכר",
  "diagnosis": "סוכרת סוג 2",
  "diagnosis_date": "2010-05-20",
  "HbA1c": 7.2,
  "eGFR": 55,
  "creatinine": 1.4,
  "current_medications": ["מטפורמין 500mg"],
  "comorbidities": ["יתר לחץ דם"],
  "pregnancy_status": null,
  "clinical_notes": "מטופל קשיש, סוכרת מאוזנת."
}

האם המטופל כשיר לניסוי?
```

### 3.8 מטופל לבדיקה #7 - צפי: לא כשיר ❌ (מחלת כבד)

```
נתוני מטופל P007:
{
  "patient_id": "P007",
  "age": 49,
  "gender": "נקבה",
  "diagnosis": "סוכרת סוג 2",
  "diagnosis_date": "2021-02-14",
  "HbA1c": 9.1,
  "eGFR": 72,
  "creatinine": 0.9,
  "current_medications": ["מטפורמין 1000mg", "סיטאגליפטין 100mg"],
  "comorbidities": ["שחמת כבד ראשונית"],
  "pregnancy_status": "לא בהריון",
  "clinical_notes": "מחלת כבד פעילה במעקב."
}

האם המטופל כשיר לניסוי?
```

### 3.9 מטופל לבדיקה #8 - צפי: לא ברור ⚠️ (חסר HbA1c)

```
נתוני מטופל P008:
{
  "patient_id": "P008",
  "age": 61,
  "gender": "זכר",
  "diagnosis": "סוכרת סוג 2",
  "diagnosis_date": "2017-09-05",
  "HbA1c": null,
  "eGFR": 68,
  "creatinine": 1.1,
  "current_medications": ["מטפורמין 850mg פעמיים ביום"],
  "comorbidities": [],
  "pregnancy_status": null,
  "clinical_notes": "לא נמדד HbA1c ב-3 החודשים האחרונים."
}

האם המטופל כשיר לניסוי?
```

---

## 📋 שלב 4: איטרציה ושיפור

### 4.1 בדיקת תוצאות
לאחר הרצת כל 8 המטופלים, השווה לטבלה:

| מטופל | תוצאה צפויה | סיבה עיקרית |
|-------|-------------|--------------|
| P001 | ✅ כשיר | עומד בכל הקריטריונים |
| P002 | ❌ לא כשיר | HbA1c 11.5% > 10% |
| P003 | ❌ לא כשיר | eGFR 38 < 45 + אינסולין |
| P004 | ❌ לא כשיר | הריון |
| P005 | ✅ כשיר | מועמד אידיאלי |
| P006 | ❌ לא כשיר | גיל 77 > 75 |
| P007 | ❌ לא כשיר | שחמת כבד |
| P008 | ⚠️ לא ברור | חסר HbA1c |

### 4.2 אם יש שגיאות - שפר את הפרומפט
- הוסף דוגמאות (few-shot)
- הבהר קריטריונים לא ברורים
- הוסף כללים לטיפול במקרי קצה

### 4.3 שמירת הפרומפט
1. לחץ על **"Save"** בפינה הימנית העליונה
2. תן שם: "Clinical Trial Screening - DM2"
3. הפרומפט נשמר לשימוש עתידי

---

## 📋 שלב 5: ייצוא לקוד (אופציונלי)

### 5.1 קבלת קוד Python
1. לחץ על **"Get code"** בפינה הימנית העליונה
2. בחר **Python**
3. העתק את הקוד

### 5.2 דוגמה לקוד שיתקבל:
```python
import google.generativeai as genai

genai.configure(api_key="YOUR_API_KEY")

model = genai.GenerativeModel(
    model_name="gemini-2.0-flash",
    system_instruction="..."  # הפרומפט שלך
)

response = model.generate_content("נתוני המטופל...")
print(response.text)
```

---

## ✅ קריטריונים להצלחה בשלב זה

- [ ] הפרומפט מוגדר ב-System Instructions
- [ ] 8/8 מטופלים נבדקו
- [ ] לפחות 7/8 תוצאות נכונות
- [ ] הפורמט עקבי בכל התשובות
- [ ] הפרומפט נשמר

**לאחר הצלחה → עבור לשלב 2: Gemini Gems + Opal**

---

## 🔗 קישורים שימושיים

- Google AI Studio: https://aistudio.google.com
- תיעוד: https://ai.google.dev/docs
- דוגמאות פרומפטים: https://ai.google.dev/examples
